<html layout:decorate="~{layout}">
<div layout:fragment="content" class="w-full my-3 flex justify-center text-white">
    <div class="h-screen flex items-center justify-center bg-black">
        <div class="bg-gray-800 p-6 rounded-lg max-w-lg mx-auto">
            <form id="trainerForm" action="/trainer/create" method="post" enctype="multipart/form-data">
                <div class="pt-4">
                    <label for="userTrainer" class="form-label">트레이너 목록</label>
                    <select id="userTrainer" name="userTrainerId"
                        class="input input-bordered w-full max-w-xs text-black">
                        <option th:each="userTrainer : ${userTrainerList}" th:value="${userTrainer.id}"
                            th:text="${userTrainer.name}"></option>
                    </select>
                    <div id="errorMessage" class="text-red-500"></div>
                </div>
                <div class="pt-4">
                    <label class="flex flex-col">레슨 종류</label>
                    <input type="checkbox" id="classTypeHealth" name="classType" value="Health"
                        class="checkbox checkbox-primary mr-2">
                    <label for="classTypeHealth">헬스</label>
                    <input type="checkbox" id="classTypePT" name="classType" value="PT"
                        class="checkbox checkbox-primary mr-2">
                    <label for="classTypePT">PT</label>
                    <input type="checkbox" id="classTypePilates" name="classType" value="Pilates"
                        class="checkbox checkbox-primary mr-2">
                    <label for="classTypePilates">필라테스</label>
                </div>
                <div class="pt-4">
                    <label class="flex flex-col">전문화</label>
                    <input type="checkbox" id="specialization1to1" name="specialization" value="1"
                        class="checkbox checkbox-primary mr-2">
                    <label for="specialization1to1">1:1</label>
                    <input type="checkbox" id="specialization1toN" name="specialization" value="2"
                        class="checkbox checkbox-primary mr-2">
                    <label for="specialization1toN">1:n</label>
                    <input type="checkbox" id="specializationNtoN" name="specialization" value="3"
                        class="checkbox checkbox-primary mr-2">
                    <label for="specializationNtoN">n:n</label>
                </div>
                <div class="pt-4">
                    <label for="introduce" class="flex flex-col">소개</label><br>
                    <textarea id="introduce" name="introduce" rows="4" cols="50"
                        class="textarea textarea-bordered w-full text-black"></textarea>
                </div>
                <div class="pt-4">
                    <label for="image" class="flex flex-col">이미지 업로드</label>
                    <input type="file" id="image" name="image" accept="image/*"
                        class="file-input file-input-bordered text-black">
                </div>
                <div class="pt-4">
                    <button type="button" id="submitBtn" class="btn btn-error w-full">등록</button>
                </div>
            </form>
        </div>
    </div>
    
<script>
    document.addEventListener("DOMContentLoaded", function () {
        console.log("load");
        var userTrainerSelect = document.getElementById("userTrainer");
        var errorMessage = document.getElementById("errorMessage");
        var submitBtn = document.getElementById("submitBtn");

        userTrainerSelect.addEventListener("change", function () {
            var trainerId = this.value;
            checkDuplicateTrainer(trainerId);
        });

        function checkDuplicateTrainer(trainerId) {
            console.log("click");
            var xhr = new XMLHttpRequest();
            xhr.open("GET", "/trainer/checkDuplicate/" + trainerId);
            xhr.onload = function () {
                if (xhr.status === 200) {
                    var response = JSON.parse(xhr.responseText);
                    if (response === true) {
                        errorMessage.textContent = '이미 등록된 트레이너입니다.';
                        submitBtn.disabled = true; // 폼 제출 방지
                        console.log("true");
                    } else {
                        errorMessage.textContent = '';
                        submitBtn.disabled = false; // 폼 제출 이벤트 활성화
                        console.log("false");
                    }
                } else {
                    console.error('Request failed. Status: ' + xhr.status);
                }
            };
            xhr.onerror = function () {
                console.error('Error checking duplicate trainer');
            };
            xhr.send();
        }

        submitBtn.addEventListener("click", function (event) {
            event.preventDefault(); // 기본 제출 이벤트 방지
            document.getElementById("trainerForm").submit(); // 폼 수동 제출
        });
    });
</script>
</div>


</html>